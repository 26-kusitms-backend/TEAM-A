# Message Queue

### 메세지 큐 정의
```
메세지 큐(Message Queue)란 프로세스 간에 데이터를 교환할 때 사용되는 통신 방법 중에 하나이다. 

더 큰 개념으로는 MOM(Message Oriented Middleware: 메세지 지향 미들웨어)를 의미한다. 

MOM이란 비동기 메세지를 사용하는 프로그램 간 데이터 송수신을 의미하며, MOM을 구현한 서비스를 MQ라고 한다.

MQ에는 여러종류가 있는데 대표적으로는 Kafka, RabbitMQ, ActiveMQ(JMS) 가 있다.
```

<br/>

### 메세지 큐 사용 이유
* 메세지 큐는 IPC(Inter-Process Communication) 도구 중 하나로, 시스템 프로그래밍에서 사용된다.
```
이는 프로세스들 간에 데이터 송수신을 위해 사용하는데, 각 데이터를 메세지 형태로 생성, 전달하고 수신이 가능하게끔 Queue 데이터구조를 이용한다.
```

<br/>

* 분산 메시징 시스템에 활용된다.
```
모니터링, 로그, 이벤트 메시지 등 아주 거대한 양의 데이터를 다룰 일이 생김에 따라 필요하게된다.

Queue는 여러 컴포넌트들이 데이터를 생성하고 또 저장하고 사용하는 과정에서 일종의 버퍼 역할을 수행한다.

이로인해 Producer와 Consumer간의 속도가 다를 때, 둘 중 어느 한 컴포넌트가 장애가 발생했을 때 상황 등에 대응이 가능하다. 따라서 장애 전파를 막을 수 있다.

기본적으로 분산 메시징 시스템은 어떤 특정 메시지가 최소한 한번은 전달될 수 있도록 보장하며 다수의 reader와 writer를 하나의 큐를 통해서 공유하고 상호작용할 수 있게끔 만든다.
```

<br/>

```
의문점

- 첫번째의 이유로 사용하는 경우가 있나?
```

<br/>

### 메세지 큐 장점
```
- 비동기(Asynchronous): Queue에 넣어두기 때문에 나중에 처리할 수 있다.

- 분리 또는 비동조(Decoupling): 애플리케이션과 분리할 수 있다.

- 탄력성(Resilience): 일부가 실패 시 전체에 영향을 받지 않는다.

- 과잉(Redundancy): 실패 할 경우 재실행이 가능하다.

- 보증(Guarantees): 작업이 처리된 걸 확인할 수 있다.

- 확장성(Scalable): 다수의 프로세스들이 큐에 메시지를 보낼 수 있다.
```

<br/>

출처: [메세지 큐와 종류 그리고 비교](https://err0rcode7.github.io/backend/2021/06/19/%EB%A9%94%EC%8B%9C%EC%A7%80-%ED%81%90%EC%99%80-%EC%A2%85%EB%A5%98-%EA%B7%B8%EB%A6%AC%EA%B3%A0-%EB%B9%84%EA%B5%90.html)<br/>
출처: [메세지 큐란 무엇인가](https://velog.io/@kimjaejung96/%EB%A9%94%EC%84%B8%EC%A7%80-%ED%81%90Message-Queue%EB%9E%80-%EB%AC%B4%EC%97%87%EC%9D%B8%EA%B0%80)

<br/>

### 카프카(Kafka)의 특징
대용량 실시간 로그처리에 특화되어 설계된 메시징 시스템으로 TPS가 매우 우수하고,

메시지를 메모리에 저장하는 기존 메시징 시스템과는 달리 파일에 저장을 하는데 그로 인해 카프카를 재시작해도 메시지 유실 우려가 감소된다.

기본 메시징 시스템(rabbitMQ, ActiveMQ)에서는 브로커(Broker)가 컨슈머(consumer)에게 메시지를 push해 주는 방식인데, 

카프카는 컨슈머(Consumer)가 브로커(Broker)로부터 메시지를 직접 가져가는 PULL 방식으로 동작하기 때문에 컨슈머는 자신의 처리 능력만큼의 메시지만 가져와 최적의 성능을 낼 수 있다. 

대용량처리에 특화 되었다는 것은 아마도 이러한 구조로 설계가 되어 가능하게 된게 아닌가 싶다.

![99715B3A5C3FE33B10](https://user-images.githubusercontent.com/92728780/194499684-37a30571-ea19-4281-aa0c-e5e8657a6eb4.png)

여기서 한가지 의문이 든다. 

일반적으로 파일보다 메모리가 성능이 우수한데 왜 카프카가 성능이 좋은 것일까? 그 이유는 카프카의 파일 시스템을 활용한 고성능 디자인에 있다. 

일반적으로 하드디스크는 메모리보다 수백배 느리지만 하드디스크의 순차적 읽기에 대한 성능은 메모리보다 크게 떨어지지 않는다고 한다. 

<br/>

![img1 daumcdn](https://user-images.githubusercontent.com/92728780/194500586-0d7738dd-a4f8-4da2-a4f2-7619128926b9.jpg)
```
* 파일 시스템을 활용한 고성능 디자인

Kafka는 기존 메시징 시스템과는 달리 메시지를 메모리대신 파일 시스템에 쌓아두고 관리한다.

메시지는 하드디스크로부터 순차적으로 읽혀지기 때문에 하드디스크의 랜덤 읽기 성능에 대한 단점을 보완함과 동시에 OS 페이지 캐시를 효과적으로 활용할 수 있다.
```

<br/>

출처: [카프카의 이해](https://team-platform.tistory.com/11)<br/>
출처: [Apache Kafka - 설명](https://creds.tistory.com/178)
