# 메세지 큐

메세지 큐는 프로세스 또는 프로그램 간에 데이터를 교환할 때 사용하는 통신 방법 중에 하나로, 메세지 지향 미들웨어를 구현한 시스템을 의미한다. 메세지 지향 미들웨어는 비동기 메세지를 사용하는 응용 프로그램들 사이에서 데이터를 송수신하는 것을 의미한다. 여기서 메세지는 요청, 응답, 오류 메세지 혹은 단순한 정보 등의 작은 데이터가 될 수 있다. 

메세지 브로커는 송신자로부터 전달받은 메세지를 수신자로 전달해주는 중간 역할이다. 이때 메세지가 적재되는 공간이 메세지 큐이며, 메세지의 그룹을 토픽이라 한다.

예를 들어, 실시간 데이터를 수집하는 서버 A와 이를 가공해서 사용하는 서버 B 2대가 있다고 하자. B는 A를 사용하기 위해 어떻게 해야 할까?

가장 일반적인 방법은 rdb에 저장하고 B가 이를 조회해서 사용하는 것이다. 그러나 실시간이라는 특수 환경에서는 이것이 불가능하다. 

이러한 상황에 사용하는 것이 메세지 브로커이다. A에서 수집한 데이터를 바로 메세지 큐에 송신하고 B는 메세지를 구독하여 바로 사용하게 한다. 메세지 브로커를 사용하면 B는 별도의 조회 과정 없이도 메세지 큐에 적재되는 메세지를 감시하고 있다가 메세지가 적재되면 바로 가져다가 사용할 수 있다.

이런 구조를 발행-구독 패턴이라 한다. 

대표적인 메세지 브로커(메세지큐)에는 apache kafka, redis, rabbitMQ, celery 등이 있다.

조회 측면에서는 rdb에 비해 빠르다는 성능 상의 이점이 있지만, 단점도 존재한다. db를 사용하면 쿼리문을 이용해 원하는 데이터를 필터링해서 조회할 수 있지만, 메세지 브로커는 별도의 필터링 과정을 거치지 않고 적재된 데이터를 그대로 사용한다. 그래서 적재할 때 필터링된 데이터를 적재하던가 적재된 데이터를 logstash를 이용하여 필터링해서 사용해야 한다. 또한 메세지 큐에는 보통 7일 정도 메세지를 보관하기 때문에 장기간 보관해야 하는 경우 별도의 저장소에 저장해야 한다.