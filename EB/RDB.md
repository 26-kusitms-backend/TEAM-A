# RDB

관계형 데이터베이스에서는 식별자를 갖는다.

1. primary key

엔티티를 대표하는 키

2. Candidate key

유일성과 최소성을 만족하는 키

3. Super key

유일성만 만족하는 키

4. Alternative key

기본키를 제외한 나머지 후보키

5. Foreign key

여러 테이블의 PK

## 외래키의 장점과 단점

외래키는 테이블과 테이블 간의 관계를 맺어주는 역할을 한다.  외래키로 인해 발생할 수 있는 문제가 있는지 고민을 해본 적이 있는가?

1. 자식 테이블에 insert 시에 부모 테이블이 존재하는 지 확인해야 하는 비용이 발생한다.
자식 테이블에 insert 시, 부모 테이블이 존재하는 지 확인하는 비용은 분명히 수행되는 오버헤드이다. 하지만 OLTP에서 영향을 끼칠만한 오버헤드는 아니다.
> OLTP 란 <br/> 온라인 트랜잭션 처리를 말하며, 네트워크 상의 온라인 사용자들의 DB에 대한 일괄 트랜잭션 처리를 의미한다. 트랜잭션의 주 특징은 grouping된 연산의 실패 시, rollback이 지원된다는 점이다. 주로 기술적 특성상 대규모의 처리보다는 소규모의 정교한 데이터 구성이 필요한 데이터의 처리가 중점이 된다.

외래키를 사용하지 않으면 결국 부모 테이블이 존재하는 지 select 쿼리를 어플리케이션 단에서 날려야 한다. 이렇게 되면 오버헤드도 발생하고 참조 무결성도 지켜지지 않는다.

외래키가 체크하는 무결성
- 자식 테이블에 insert 할 때, 참조키가 부모 테이블에 존재하는지
- 자식 테이블에서 참조키를 update할 때, 변경 후 값이 부모 테이블에 존재하는지
- 부모 테이블에서 delete할 때, 자식 테이블에서 참조하고 있는지


이 과정을 외래키 없이 비즈니스 로직 단에서 어떻게 확인할 수 있을까? 이 과정에 앞서 select 연산을 해야 한다. 이에 따른 비용이 더 크기 때문에 외래키를 사용하는 것이 프로그램에서는 더 가볍고 빠른 처리가 가능하다.

또하, 외리키에 index를 거는 것은 필수 작업이다. 외래키를 쓰던 쓰지 않던 무결성을 빠르게 확인하려면 꼭 인덱스가 필요하다.

2. 테이블 구조 변경 시, 고려사항이 많이 생긴다.

기존 테이블이 참조 무결성 정합성에 맞지 않아서 외래키를 달고 싶어도 달 수 없다는 고려 사항이 있다. 이 경우, 외래키를 달 때 enable novalidate 옵션으로 생성해주면 해결된다. 기본 설정은 enable validate인데, 의미는 기존 데이터들에 대해 vaildation 검사 수행 후, 성공하면 enable 시킨다는 뜻이다.

대량의 데이터 로딩 시, 외래키 정합성 검사시간을 생략하고자 할 때에도 사용하면 좋은 옵션이다. 로딩 전 disable 시키고 로딩 후 이 옵션으로 enable 시키는 것이다.

3. 테스트 데이터 만드는 것이 불편하다. 
이 상황은 실제로 프로젝트를 하면서 경험했던 점이라 많이 공감한다.

테스트 데이터 생서 시, 부모 테이블에 먼저 부모 row를 생성하고 나중에 자식 테이블에 자식 row를 생성해야 하는 데, 이게 번거로울 수 있다. 이 문제는 개발 기간 중엔 외래키를 disable 시켜 놓으면 해결된다.

트랜잭션 안에서 부모 테이블과 자식 테이블의 관계에 따라 DML 작업의 순서가 필요해진다. 예를 들어, insert 작업이라면 부모 row 먼저, 자식 row 나중의 순서로 작업해야 하고, delete라면 그 반대로 수행해야 한다. 외래키가 없다면 이런 순서에 얽메이지 않고 개발할 수 있다. 이 문제는 외래키를 만들 때, deffered 옵션으로 만들면 된다. deffered의 의미는 vaildation 검사를 트랜잭션 단위로 한다는 뜻이다. 쉽게 말해 commit 할 때 정합성 검사를 수행한다는 뜻이다. 기본 설정은 not deffered 이다. 이는 문장 단위로 검사한다는 뜻이다. 즉 매 쿼리마다 검사하기 때문에 순서가 맞지 않으면 오류가 발생되는 것이다. 따라서 외래키를 deffered로 만들어서 disable 시켜 놓은 후 개발하고 개발이 끝나고 테스트하기 전에 enable 시키면 개발단계에서의 불편들을 해결할 수 있을 것이다. 
